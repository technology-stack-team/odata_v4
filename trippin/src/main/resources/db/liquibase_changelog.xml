<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
    <property name="schemaName" value="Trippin"></property>
    <changeSet id="v1-01-01" author="rahul-jain">
        <createTable schemaName="${schemaName}"  tableName="Person">
            <column name="UserName" type="VARCHAR(250)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="FirstName" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="LastName" type="VARCHAR(26)"/>
            <column name="MiddleName" type="VARCHAR(250)"/>
            <column name="Income" type="DECIMAL"/>
            <column name="DateOfBirth" type="DATE"/>
            <column name="Photo" type="BINARY"/>
            <column name="Gender" type="INTEGER"/>
            <column name="Age" type="INTEGER"/>

            <column name="HomeAddress_Address" type="VARCHAR(500)"/>
            <column name="HomeAddress_Code" type="INTEGER"/>
            <column name="HomeAddress_CityName" type="VARCHAR(250)"/>
            <column name="HomeAddress_CityCountryRegion" type="VARCHAR(100)"/>
            <column name="HomeAddress_CityRegion" type="VARCHAR(200)"/>

            <column name="BossOffice_Address" type="VARCHAR(500)"/>
            <column name="BossOffice_Code" type="INTEGER"/>
            <column name="BossOffice_CityName" type="VARCHAR(250)"/>
            <column name="BossOffice_CityCountryRegion" type="VARCHAR(100)"/>
            <column name="BossOffice_CityRegion" type="VARCHAR(200)"/>

            <column name="FavoriteFeature" type="SMALLINT">
                <constraints nullable="false"/>
            </column>
            <column name="Friend" type="VARCHAR(250)"/>
            <column name="DType" type="VARCHAR(31)"/>
            <column name="Cost" type="BIGINT">
            </column>
            <column name="Budget" type="BIGINT">
            </column>
        </createTable>
    </changeSet>
    <changeSet id="v1-01-02" author="rahul-jain">
        <addForeignKeyConstraint baseTableName="Person" baseTableSchemaName="${schemaName}" baseColumnNames="Friend" constraintName="BestFriend_fk" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-01-03" author="rahul-jain">
        <createTable tableName="EmployeePeer" schemaName="${schemaName}">
            <column name="Id" type="SERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="UserName" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="Peer" type="VARCHAR(250)">
                <constraints nullable="false" checkConstraint="UserName != Peer"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="v1-01-04" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="EmployeePeer" baseColumnNames="UserName" constraintName="EmployeePeer_Manager_fk" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-01-05" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="EmployeePeer" baseColumnNames="Peer" constraintName="EmployeePeer_Person_fk" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-01-06" author="rahul-jain">
        <createTable tableName="ManagerDirectReport" schemaName="${schemaName}">
            <column name="Id" type="SERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="UserName" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="DirectReport" type="VARCHAR(250)">
                <constraints nullable="false" checkConstraint="UserName != Peer"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="v1-01-07" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="ManagerDirectReport" baseColumnNames="UserName" constraintName="ManagerDirectReport_Manager_fk" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-01-08" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="ManagerDirectReport" baseColumnNames="DirectReport" constraintName="ManagerDirectReport_Person_fk" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-02-01" author="rahul-jain">
        <createTable  schemaName="${schemaName}" tableName="Trip">
            <column name="TripId" type="SERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
<!--            <column name="UserName" type="VARCHAR(250)">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
            <!--        <column name="ShareId" type="VARCHAR(100)" >-->
            <!--            <constraints nullable="false"/>-->
            <!--        </column>-->
            <column name="Name" type="VARCHAR(250)"/>
            <column name="Budget" type="FLOAT"/>
            <column name="Description" type="VARCHAR(2500)"/>
            <column name="StartsAt" type="TIMESTAMP"/>
            <column name="EndsAt" type="TIMESTAMP"/>
            <column name="StartTime" type="TIME"/>
            <column name="EndTime" type="TIME"/>
        </createTable>
    </changeSet>
    <changeSet id="v1-02-02" author="rahul-jain">
        <createTable schemaName="${schemaName}"  tableName="PersonTrip">
            <column name="Id" type="SERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="UserName" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="TripId" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="v1-02-03" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="PersonTrip" baseColumnNames="UserName" constraintName="Person_PersonTrip_fk" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-02-04" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="PersonTrip" baseColumnNames="TripId" constraintName="Trip_PersonTrip_fk" referencedTableName="Trip"
                                 referencedColumnNames="TripId" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-02-05" author="rahul-jain">
       <addUniqueConstraint tableName="PersonTrip" schemaName="${schemaName}" columnNames="UserName,TripId" />
    </changeSet>

    <changeSet id="v1-03-01" author="rahul-jain">
        <createTable schemaName="${schemaName}"  tableName="PersonEmail">
            <column name="Id" type="SERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="UserName" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="Emails" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="v1-03-02" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="PersonEmail" baseColumnNames="UserName" constraintName="Person_PersonEmail_fk" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-04-01" author="rahuljain">
        <createTable schemaName="${schemaName}"  tableName="PersonAddressInfo">
            <column name="Id" type="SERIAL" autoIncrement="true">
                <constraints  primaryKey="true" primaryKeyName="PersonAddressInfo_pk"/>
            </column>
            <column name="UserName" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="Address" type="VARCHAR(500)"/>
            <column name="Code" type="INTEGER"/>
            <column name="LocationName" type="VARCHAR(250)"/>
            <column name="CountryRegion" type="VARCHAR(100)"/>
            <column name="Region" type="VARCHAR(200)"/>
        </createTable>
    </changeSet>
    <changeSet id="v1-04-02" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="PersonAddressInfo" baseColumnNames="UserName" constraintName="Person_PersonAddressInfo_fk" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-05-01" author="rahul-jain">
        <createTable schemaName="${schemaName}"  tableName="PersonFeature">
            <column name="Id" type="SERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="UserName" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="Features" type="SMALLINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="v1-05-02" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="PersonFeature" baseColumnNames="UserName" constraintName="Person_PersonFeature_fk" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-05-03" author="rahul-jain">
        <addUniqueConstraint tableName="PersonFeature" columnNames="UserName,Features" schemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-06-01" author="rahul-jain">
        <createTable schemaName="${schemaName}"  tableName="PersonFriend">
            <column name="Id" type="SERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="UserName" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="Friend" type="VARCHAR(250)">
                <constraints nullable="false" checkConstraint="UserName != Friend"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="v1-06-02" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="PersonFriend" baseColumnNames="UserName" constraintName="Person_PersonFriend_fk" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-06-03" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="PersonFriend" baseColumnNames="Friend" constraintName="Person_PersonFriend_fk2" referencedTableName="Person"
                                 referencedColumnNames="UserName" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-06-04" author="rahul-jain">
        <createIndex tableName="PersonFriend" indexName="UserName_Friend_unique" schemaName="${schemaName}" unique="true">
            <column name="UserName"></column>
            <column name="Friend"></column>
        </createIndex>
    </changeSet>
    <changeSet id="v1-07-04" author="rahul-jain">
        <createTable schemaName="${schemaName}"  tableName="Airport">
            <column name="IcaoCode" type="VARCHAR(250)">
                <constraints primaryKey="true" nullable="false" primaryKeyName="airport_icao_pk"/>
            </column>
            <column name="ETag" type="BIGINT">
                <constraints  nullable="false"/>
            </column>
            <column name="Name" type="VARCHAR(250)"/>
            <column name="IataCode" type="VARCHAR(250)"/>
            <column name="Loc" type="VARCHAR(250)"/>

            <column name="latitude" type="DECIMAL"/>
            <column name="longitude" type="DECIMAL"/>
            <column name="IsInsideCity" type="BOOLEAN"/>
            <column name="Address" type="VARCHAR(500)"/>
            <column name="Code" type="INTEGER"/>
            <column name="LocationName" type="VARCHAR(250)"/>
            <column name="CountryRegion" type="VARCHAR(100)"/>
            <column name="Region" type="VARCHAR(200)"/>

        </createTable>
    </changeSet>
    <changeSet id="v1-09-01" author="rahul-jain">
        <createTable tableName="Airline" schemaName="${schemaName}">
            <column name="AirlineCode" type="VARCHAR(250)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="Name" type="VARCHAR(250)"/>
        </createTable>
    </changeSet>
    <changeSet id="v1-08-01" author="rahuljain">
        <createTable tableName="BasePlanItem" schemaName="${schemaName}">
            <column name="PlanItemId" type="SERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="Type" type="VARCHAR(2)"/>
            <column name="ConfirmationCode" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="StartsAt" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="EndsAt" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="Duration" type="VARCHAR(500)">
                <constraints nullable="false"/>
            </column>
            <column name="Address" type="VARCHAR(500)"/>
            <column name="Code" type="INTEGER"/>
            <column name="LocationName" type="VARCHAR(250)"/>
            <column name="CountryRegion" type="VARCHAR(100)"/>
            <column name="Region" type="VARCHAR(200)"/>
            <column name="BuildingInfo" type="VARCHAR(250)"/>
            <column name="Description"  type="VARCHAR(250)"/>
            <column name="SeatNo" type="VARCHAR(50)"/>
            <column name="FlightNumber" type="VARCHAR(250)"/>
            <column name="FlightAirline" type="VARCHAR(250)"/>
            <column name="FlightFrom" type="VARCHAR(250)"/>
            <column name="FlightTo" type="VARCHAR(250)"/>
        </createTable>
    </changeSet>
    <changeSet id="v1-08-02" author="rahul-jain">
        <addForeignKeyConstraint baseTableName="BasePlanItem" baseColumnNames="FlightAirline" baseTableSchemaName="${schemaName}" constraintName="Flight_Airline_fk" referencedTableName="Airline"
                                 referencedColumnNames="AirlineCode" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-08-03" author="rahul-jain">
        <addForeignKeyConstraint baseTableName="BasePlanItem" baseColumnNames="FlightTo" baseTableSchemaName="${schemaName}" constraintName="Flight_Airport_To_fk" referencedTableName="Airport"
                                 referencedColumnNames="IcaoCode" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v1-08-04" author="rahul-jain">
        <addForeignKeyConstraint baseTableName="BasePlanItem" baseColumnNames="FlightFrom" baseTableSchemaName="${schemaName}" constraintName="Flight_Airport_From_fk" referencedTableName="Airport"
                                 referencedColumnNames="IcaoCode" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v2-01-01" author="rahul-jain">
        <createTable tableName="TripTag" schemaName="${schemaName}">
            <column name="Id" type="SERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="TripId" type="INTEGER"/>
            <column name="Tag" type="VARCHAR(250)"/>
        </createTable>
    </changeSet>
    <changeSet id="v2-01-02" author="rahul-jain">
        <addForeignKeyConstraint baseTableName="TripTag" baseTableSchemaName="${schemaName}" baseColumnNames="TripId" constraintName="Trip_TripTag_fk" referencedTableName="Trip"
                                 referencedColumnNames="TripId" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v2-02-01" author="rahul-jain">
        <createTable tableName="TripPlanItem" schemaName="${schemaName}">
            <column name="Id" type="SERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="TripId" type="INTEGER"/>
            <column name="PlanItemId" type="INTEGER"/>
        </createTable>
    </changeSet>
    <changeSet id="v2-02-02" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="TripPlanItem" baseColumnNames="TripId" constraintName="Trip_TripPlanItem_fk" referencedTableName="Trip"
                                 referencedColumnNames="TripId" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v2-02-03" author="rahul-jain">
        <addForeignKeyConstraint baseTableSchemaName="${schemaName}" baseTableName="TripPlanItem" baseColumnNames="PlanItemId" constraintName="Trip_PlanItem_fk" referencedTableName="BasePlanItem"
                                 referencedColumnNames="PlanItemId" referencedTableSchemaName="${schemaName}"/>
    </changeSet>
    <changeSet id="v2-03-01" author="rahul-jain">
        <createProcedure catalogName="PERSON_WITH_MOST_FRIENDS"
                         dbms="postgresql"
                         encoding="utf8"
                         path="db/functions.sql"
                         procedureName="PERSON_WITH_MOST_FRIENDS"
                         relativeToChangelogFile="true"
                         schemaName="${schemaName}"></createProcedure>
    </changeSet>
</databaseChangeLog>